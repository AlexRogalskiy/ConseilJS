parameter key_hash;
storage
  (pair :storage
     (timestamp %auction_end)
     (pair (mutez %highest_bid) (key_hash %bidder)));
code { DUP ;
       DIP { CDR @storage_slash_1 } ;
       CAR @parameter_slash_2 ;
       DUUP @storage ;
       CAR %auction_end ;
       NOW ;
       COMPARE ;
       GT ;
       IF { UNIT ; FAILWITH } { UNIT } ;
       DROP ;
       AMOUNT @new_bid ;
       DUUUP @storage ;
       CDAR %highest_bid ;
       DUUP @new_bid ;
       COMPARE ;
       LE ;
       IF { UNIT ; FAILWITH } { UNIT } ;
       DROP ;
       DUUUP @storage ;
       CDDR @previous_bidder %bidder ;
       IMPLICIT_ACCOUNT @refund_to ;
       DUUUUP @storage ;
       CDAR @previous_bid %highest_bid ;
       UNIT ;
       TRANSFER_TOKENS @op ;
       DUUUUP @storage ;
       DUP ;
       CAR %auction_end ;
       SWAP ;
       CDR ;
       CDR %bidder ;
       DUUUUP @new_bid ;
       DIIIIP { DROP } ;
       DIIIIIP { DROP } ;
       PAIR %highest_bid %bidder ;
       SWAP ;
       PAIR @storage %auction_end ;
       DUP ;
       CAR %auction_end ;
       SWAP ;
       CDR ;
       CAR %highest_bid ;
       DUUUUP ;
       DIIIIP { DROP } ;
       SWAP ;
       PAIR %highest_bid %bidder ;
       SWAP ;
       PAIR @storage %auction_end ;
       NIL operation ;
       DUUUP ;
       DIIIP { DROP } ;
       CONS ;
       PAIR };